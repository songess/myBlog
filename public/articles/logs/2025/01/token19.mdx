---
id: token19
title: 토큰처리
date: 2025-01-09
---

오늘 배포본에서 토큰확인을 해봤고 정상적으로 확인할 수 있었다. 즉 넥스트 웹서버에서도 토큰을 확인할 수 있었다.

이제 배포본에서는 정상적으로 쿠키를 통한 로그인 관리가 가능하다는 뜻이다. 그럼 남은 문제는, 

## 1. AT를 바꿔서 정상적으로 동작할 수 있을까?
1. mypage에서 로그인 여부에 따른 리다이렉트 - 미들웨어에서 정상적으로 처리 가능

2. 다른 페이지에서 로그인 여부에 따른 컴포넌트 렌더링 - `cookies().get`을 통해 처리 가능

3. 요청을 구분 -> 일부 요청을 가능할 거 같은데, 위경도를 실어서 보내야하는 요청을 서버에서 처리가 불가능하다. 즉 새로운 정보가 담기지 않는 요청에 선에서는 가능 

## 1.1 RT(AT)를 브라우저 단에서 삭제할 수 없는건가?
일단 프론트는 접근할 수 없으니깐 불가능. 백엔드는 아무래도 가능해 보이니깐 가능할 것으로 보인다.

## 2. 어떻게 로컬에서 확인할 수 있을까?
문제는 로컬서버의 도메인이 `localhost:3000`이라는 것이다. 그럼 이걸 어떻게 바꿀 수 있을까..?

`rewrites`를 사용하려 했는데, 일단 수행도 안될 뿐더러 바꾼다고 해도 실행되는 넥스트 서버 자체는 `localhost:3000`이고 요청이 `tigleisure`로 보내지는거라 잡을 수 없다.

`ngrok`라는 것을 알아봤는데, 이건 도메인 설정이 불가능했다.

그래서 어느정도 성공한 방식은 `sudo vi /etc/hosts`를 사용하고 localhost의 ip주소에 `local.tigleisure.com` 도메인을 붙이고, 로컬에서 저 도메인으로 접속하니 RT가 잡혔다.

근데 이상한 에러가 떴다. `useSuspenseQuery`를 사용해서 data값이 정의됨이 보장된 친구들임에도 undefined에러가 떴다.

확인해보니 이 요청을 서버에서 처리한 거 같다. 근데 API 훅이 클라이언트컴포넌트에 존재하는데, 그럼 서버에서 요청하는거 아닌가?

심지어 배포서버에서는 에러가 안뜨고 이렇게 인위적으로 만든 곳에서만 에러가 뜬다.

<br/> 아무래도 시연영상촬영을 먼저 해야할 듯 싶다.